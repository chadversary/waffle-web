<!DOCTYPE html>
<html>

  <head>
    <title>Waffle/Examples/simple-x11-egl</title>

    <link href="../waffle.css" rel="stylesheet" type="text/css">

    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="Generator" content="Vim/7.3">
    <meta name="plugin-version" content="vim7.3_v10">
    <meta name="syntax" content="c">
  </head>

<body>

<h1><img src="../waffle.jpg" alt="Yummy waffles"/></h1>

<h2><a href="../index.html">Waffle</a>/<a href="index.html">Examples</a>/simple-x11-egl</h2>

<pre class="code">

<span class="Comment">/// @file simple-x11-egl.c</span>
<span class="Comment">///</span>
<span class="Comment">/// This little example program renders to an X11 window with EGL and an OpenGL</span>
<span class="Comment">/// ES2 context.  The program does not include any GL headers and does not need</span>
<span class="Comment">/// to link to libGL. It declares the needed GL symbols itself and obtains the</span>
<span class="Comment">/// GL functions with waffle_dl_sym().</span>
<span class="Comment">///</span>
<span class="Comment">/// This example is too simple; it does not perform proper error checking. For</span>
<span class="Comment">/// a complete example with error checking, see gl_basic.c.</span>

<span class="PreProc">#include </span><span class="Constant">&lt;stdlib.h&gt;</span>
<span class="PreProc">#include </span><span class="Constant">&lt;unistd.h&gt;</span>

<span class="PreProc">#include </span><span class="Constant">&lt;waffle.h&gt;</span>

<span class="Comment">// ---------------------------------------------</span>
<span class="Comment">// OpenGL symbols</span>
<span class="Comment">// ---------------------------------------------</span>

<span class="Type">typedef</span> <span class="Type">float</span> GLclampf;
<span class="Type">typedef</span> <span class="Type">unsigned</span> <span class="Type">int</span> GLbitfield;

<span class="Type">enum</span> {
    GL_COLOR_BUFFER_BIT = <span class="Constant">0x00004000</span>,
};

<span class="Type">static</span> <span class="Type">void</span> (*glClearColor)(GLclampf red, GLclampf green, GLclampf blue, GLclampf alpha);
<span class="Type">static</span> <span class="Type">void</span> (*glClear)(GLbitfield mask);

<span class="Comment">// ---------------------------------------------</span>

<span class="Type">int</span>
main()
{
    <span class="Type">struct</span> waffle_display *dpy;
    <span class="Type">struct</span> waffle_config *config;
    <span class="Type">struct</span> waffle_window *window;
    <span class="Type">struct</span> waffle_context *ctx;

    <span class="Type">const</span> <span class="Type">int32_t</span> init_attrs[] = {
        WAFFLE_PLATFORM, WAFFLE_PLATFORM_X11_EGL,
        <span class="Constant">0</span>,
    };

    <span class="Type">const</span> <span class="Type">int32_t</span> config_attrs[] = {
        WAFFLE_CONTEXT_API,         WAFFLE_CONTEXT_OPENGL_ES2,

        WAFFLE_RED_SIZE,            <span class="Constant">8</span>,
        WAFFLE_BLUE_SIZE,           <span class="Constant">8</span>,
        WAFFLE_GREEN_SIZE,          <span class="Constant">8</span>,

        <span class="Constant">0</span>,
    };

    <span class="Type">const</span> <span class="Type">int32_t</span> window_width = <span class="Constant">320</span>;
    <span class="Type">const</span> <span class="Type">int32_t</span> window_height = <span class="Constant">240</span>;

    waffle_init(init_attrs);
    dpy = waffle_display_connect(<span class="Constant">NULL</span>);

    <span class="Comment">// Exit if OpenGL ES2 is unsupported.</span>
    <span class="Statement">if</span> (!waffle_display_supports_context_api(dpy, WAFFLE_CONTEXT_OPENGL_ES2)
        || !waffle_dl_can_open(WAFFLE_DL_OPENGL_ES2))
    {
        exit(<span class="Constant">EXIT_FAILURE</span>);
    }

    <span class="Comment">// Get GL functions.</span>
    glClearColor = waffle_dl_sym(WAFFLE_DL_OPENGL_ES2, <span class="Constant">&quot;glClearColor&quot;</span>);
    glClear = waffle_dl_sym(WAFFLE_DL_OPENGL_ES2, <span class="Constant">&quot;glClear&quot;</span>);

    config = waffle_config_choose(dpy, config_attrs);
    window = waffle_window_create(config, window_width, window_height);
    ctx = waffle_context_create(config, <span class="Constant">NULL</span>);

    waffle_window_show(window);
    waffle_make_current(dpy, window, ctx);

    <span class="Comment">// Draw red.</span>
    glClearColor(<span class="Constant">1.0</span>, <span class="Constant">0.0</span>, <span class="Constant">0.0</span>, <span class="Constant">1.0</span>);
    glClear(GL_COLOR_BUFFER_BIT);
    waffle_window_swap_buffers(window);
    sleep(<span class="Constant">1</span>); <span class="Comment">// Sleep so that user can see window.</span>

    <span class="Comment">// Draw green.</span>
    glClearColor(<span class="Constant">1.0</span>, <span class="Constant">0.0</span>, <span class="Constant">0.0</span>, <span class="Constant">1.0</span>);
    glClearColor(<span class="Constant">0.0</span>, <span class="Constant">1.0</span>, <span class="Constant">0.0</span>, <span class="Constant">1.0</span>);
    glClear(GL_COLOR_BUFFER_BIT);
    waffle_window_swap_buffers(window);
    sleep(<span class="Constant">1</span>);

    <span class="Comment">// Draw blue.</span>
    glClearColor(<span class="Constant">0.0</span>, <span class="Constant">0.0</span>, <span class="Constant">1.0</span>, <span class="Constant">1.0</span>);
    glClear(GL_COLOR_BUFFER_BIT);
    waffle_window_swap_buffers(window);
    sleep(<span class="Constant">1</span>);

    <span class="Comment">// Clean up.</span>
    waffle_make_current(dpy, <span class="Constant">NULL</span>, <span class="Constant">NULL</span>);
    waffle_window_destroy(window);
    waffle_context_destroy(ctx);
    waffle_config_destroy(config);
    waffle_display_disconnect(dpy);

    <span class="Statement">return</span> <span class="Constant">0</span>;
}
</pre>
</body>
</html>
